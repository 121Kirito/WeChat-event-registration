# 校园活动报名系统 - 项目部署说明

## 项目概述

这是一个基于微信小程序的校园活动报名系统，包含前端小程序和后端SpringBoot服务。

## 技术栈

### 前端
- 微信小程序原生开发
- WXML + WXSS + JavaScript

### 后端
- Spring Boot 2.7.12
- MyBatis Plus 3.5.3.1
- MySQL 8.0
- Redis
- 微信小程序SDK

## 环境要求

- JDK 11+
- MySQL 8.0+
- Redis 6.0+
- 微信开发者工具
- Maven 3.6+

## 数据库配置

1. 创建数据库：
```sql
CREATE DATABASE campus_activity DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

2. 执行数据库脚本：
```bash
mysql -u root -p campus_activity < src/main/resources/database_schema.sql
```

## 后端部署

### 1. 配置数据库连接

修改 `src/main/resources/application.properties`：

```properties
# 数据库配置
spring.datasource.url=jdbc:mysql://localhost:3306/campus_activity?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
spring.datasource.username=your_username
spring.datasource.password=your_password

# 微信小程序配置
wechat.miniapp.appid=your_wechat_appid
wechat.miniapp.secret=your_wechat_secret

# Redis配置
spring.redis.host=localhost
spring.redis.port=6379
spring.redis.password=your_redis_password
```

### 2. 启动后端服务

```bash
cd WeChatproject
mvn clean install
mvn spring-boot:run
```

或者使用IDE直接运行 `WeChatprojectApplication.java`

### 3. 验证后端服务

访问 `http://localhost:8080/api/activities/page` 检查服务是否正常启动。

## 前端部署

### 1. 配置微信小程序

1. 在微信公众平台注册小程序账号
2. 获取 AppID 和 AppSecret
3. 在微信开发者工具中导入项目

### 2. 修改API地址

修改 `utils/api.js` 中的 `API_BASE_URL`：

```javascript
const API_BASE_URL = 'http://your-server-ip:8080/api';
```

### 3. 配置服务器域名

在微信公众平台配置服务器域名：
- request合法域名：`https://your-domain.com`
- uploadFile合法域名：`https://your-domain.com`

### 4. 编译运行

在微信开发者工具中点击"编译"按钮运行项目。

## API接口文档

### 认证接口

#### 微信登录
- **POST** `/api/auth/wechat/login`
- **参数**：
  ```json
  {
    "code": "微信登录code",
    "encryptedData": "加密数据（可选）",
    "iv": "初始向量（可选）"
  }
  ```

### 活动接口

#### 分页查询活动
- **GET** `/api/activities/page`
- **参数**：
  - `current`: 当前页（默认1）
  - `size`: 每页大小（默认10）
  - `keyword`: 搜索关键词（可选）
  - `categoryId`: 分类ID（可选）
  - `sortType`: 排序类型（time/deadline/popular）

#### 获取活动详情
- **GET** `/api/activities/{id}`

#### 创建活动
- **POST** `/api/activities`
- **参数**：Activity对象

### 报名接口

#### 报名活动
- **POST** `/api/registrations`
- **参数**：
  ```json
  {
    "activityId": 1,
    "userId": 1,
    "name": "姓名",
    "phone": "手机号",
    "remark": "备注（可选）"
  }
  ```

#### 取消报名
- **DELETE** `/api/registrations`
- **参数**：
  ```json
  {
    "activityId": 1,
    "userId": 1
  }
  ```

### 用户接口

#### 获取用户信息
- **GET** `/api/users/{id}`

#### 更新用户信息
- **PUT** `/api/users/{id}`
- **参数**：User对象

## 功能特性

### 前端功能
- ✅ 微信登录
- ✅ 活动列表展示
- ✅ 活动搜索和筛选
- ✅ 活动详情查看
- ✅ 活动报名
- ✅ 我的活动管理
- ✅ 个人中心
- ✅ 活动发布（管理员功能）

### 后端功能
- ✅ 微信登录集成
- ✅ 用户管理
- ✅ 活动管理
- ✅ 报名管理
- ✅ 分类管理
- ✅ 数据统计
- ✅ 分页查询
- ✅ 搜索功能

## 数据库表结构

### 核心表
- `user` - 用户表
- `activity` - 活动表
- `activity_category` - 活动分类表
- `activity_registration` - 活动报名表
- `activity_favorite` - 活动收藏表
- `activity_rating` - 活动评价表

## 部署注意事项

1. **微信小程序配置**：
   - 确保AppID和AppSecret正确配置
   - 配置服务器域名白名单
   - 开启微信登录功能

2. **数据库配置**：
   - 确保MySQL服务正常运行
   - 创建对应的数据库和用户
   - 执行初始化脚本

3. **Redis配置**：
   - 确保Redis服务正常运行
   - 配置正确的连接参数

4. **网络配置**：
   - 确保服务器可以访问微信API
   - 配置防火墙规则
   - 使用HTTPS（生产环境）

## 常见问题

### 1. 微信登录失败
- 检查AppID和AppSecret是否正确
- 确认服务器域名已配置
- 检查网络连接

### 2. 数据库连接失败
- 检查数据库服务是否启动
- 验证连接参数是否正确
- 确认数据库用户权限

### 3. 接口调用失败
- 检查后端服务是否启动
- 验证API地址是否正确
- 查看控制台错误信息

## 开发团队

- 后端开发：Spring Boot + MyBatis Plus
- 前端开发：微信小程序原生
- 数据库设计：MySQL 8.0
- 部署运维：Docker + Nginx（可选）

## 版本信息

- 当前版本：v1.0.0
- 最后更新：2024年1月
- 兼容性：微信小程序基础库 2.0+
