<!--my-activities.wxml - æˆ‘çš„æ´»åŠ¨é¡µé¢-->
<view class="container">
  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="stats-section">
    <view class="stats-card">
      <view class="stat-item">
        <text class="stat-number">{{totalRegistered}}</text>
        <text class="stat-label">å·²æŠ¥å</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{completedActivities}}</text>
        <text class="stat-label">å·²å®Œæˆ</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{upcomingActivities}}</text>
        <text class="stat-label">å³å°†å¼€å§‹</text>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰æ ‡ç­¾ -->
  <view class="filter-tabs">
    <view 
      wx:for="{{filterTabs}}" 
      wx:key="key"
      class="tab-item {{currentFilter === item.key ? 'active' : ''}}"
      bindtap="onFilterChange"
      data-key="{{item.key}}"
    >
      {{item.label}}
    </view>
  </view>

  <!-- æ´»åŠ¨åˆ—è¡¨ -->
  <scroll-view class="activities-list" scroll-y="true" bindscrolltolower="onLoadMore">
    <view wx:if="{{filteredActivities.length === 0 && !loading}}" class="empty-state">
      <text class="empty-icon">ğŸ“­</text>
      <text class="empty-text">{{getEmptyText()}}</text>
    </view>

    <view wx:for="{{filteredActivities}}" wx:key="id" class="activity-item">
      <!-- æ´»åŠ¨çŠ¶æ€æ ‡ç­¾ -->
      <view class="status-badge {{item.status}}">
        {{getStatusText(item.status)}}
      </view>

      <!-- æ´»åŠ¨ä¿¡æ¯ -->
      <view class="activity-content" bindtap="onActivityTap" data-id="{{item.id}}">
        <image class="activity-image" src="{{item.image}}" mode="aspectFill" binderror="onMyImageError" data-index="{{index}}"></image>
        
        <view class="activity-info">
          <view class="activity-header">
            <text class="activity-title">{{item.title}}</text>
            <text class="activity-date">{{item.startDate}}</text>
          </view>
          
          <text class="activity-description">{{item.description}}</text>
          
          <view class="activity-meta">
            <view class="meta-item">
              <text class="meta-icon">ğŸ•</text>
              <text class="meta-text">{{item.startTime}}</text>
            </view>
            <view class="meta-item">
              <text class="meta-icon">ğŸ“</text>
              <text class="meta-text">{{item.location}}</text>
            </view>
          </view>
          
          <view class="registration-info">
            <text class="register-time">æŠ¥åæ—¶é—´ï¼š{{item.registerTime}}</text>
            <text class="register-status" wx:if="{{item.registerStatus}}">{{item.registerStatus}}</text>
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="activity-actions">
        <button 
          class="action-btn secondary" 
          bindtap="onViewDetail" 
          data-id="{{item.id}}"
        >
          æŸ¥çœ‹è¯¦æƒ…
        </button>
        
        <button 
          wx:if="{{item.status === 'upcoming'}}"
          class="action-btn danger" 
          bindtap="onCancelRegister" 
          data-id="{{item.id}}"
        >
          å–æ¶ˆæŠ¥å
        </button>
        
        <button 
          wx:if="{{item.status === 'completed'}}"
          class="action-btn primary" 
          bindtap="onRateActivity" 
          data-id="{{item.id}}"
        >
          è¯„ä»·æ´»åŠ¨
        </button>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{loading}}" class="loading">
      <text>åŠ è½½ä¸­...</text>
    </view>
    <view wx:if="{{noMoreData && filteredActivities.length > 0}}" class="no-more">
      <text>æ²¡æœ‰æ›´å¤šæ´»åŠ¨äº†</text>
    </view>
  </scroll-view>
</view>

<!-- å–æ¶ˆæŠ¥åç¡®è®¤å¼¹çª— -->
<view class="modal-overlay" wx:if="{{showCancelModal}}" bindtap="onCloseCancelModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">å–æ¶ˆæŠ¥å</text>
    </view>
    
    <view class="modal-body">
      <text class="modal-message">ç¡®å®šè¦å–æ¶ˆæŠ¥å"{{cancelActivity.title}}"å—ï¼Ÿ</text>
      <text class="modal-warning">å–æ¶ˆåå¦‚éœ€å‚åŠ è¯·é‡æ–°æŠ¥å</text>
    </view>
    
    <view class="modal-footer">
      <button class="cancel-btn" bindtap="onCloseCancelModal">ä¸å–æ¶ˆ</button>
      <button class="confirm-btn" bindtap="onConfirmCancel">ç¡®è®¤å–æ¶ˆ</button>
    </view>
  </view>
</view>
