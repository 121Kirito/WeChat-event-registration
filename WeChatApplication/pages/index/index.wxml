<!--index.wxml - æ´»åŠ¨åˆ—è¡¨é¦–é¡µ-->
<view class="container">
  <!-- è½®æ’­å›¾ -->
  <swiper class="banner-swiper" indicator-dots="true" autoplay="true" interval="3000" duration="500">
    <swiper-item wx:for="{{bannerImages}}" wx:key="*this">
      <image class="banner-image" src="{{item}}" mode="aspectFill" binderror="onBannerImageError" data-index="{{index}}"></image>
    </swiper-item>
  </swiper>

  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input" 
        placeholder="æœç´¢æ´»åŠ¨ï¼Œå¦‚ï¼šç¯®çƒæ¯”èµ›" 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        confirm-type="search"
        bindconfirm="onSearch"
      />
    </view>
    <button class="search-btn" bindtap="onSearch">æœç´¢</button>
  </view>

  <!-- æ’åºå’Œç­›é€‰ -->
  <view class="filter-bar">
    <view class="sort-options">
      <text class="sort-label">æ’åºï¼š</text>
      <text 
        class="sort-item {{sortType === 'time' ? 'active' : ''}}" 
        bindtap="onSortChange" 
        data-type="time"
      >æœ€æ–°å‘å¸ƒ</text>
      <text 
        class="sort-item {{sortType === 'deadline' ? 'active' : ''}}" 
        bindtap="onSortChange" 
        data-type="deadline"
      >æˆªæ­¢æ—¶é—´</text>
      <text 
        class="sort-item {{sortType === 'popular' ? 'active' : ''}}" 
        bindtap="onSortChange" 
        data-type="popular"
      >æŠ¥åäººæ•°</text>
    </view>
    
    <!-- ç­›é€‰åŠŸèƒ½ -->
    <view class="filter-options">
      <view class="filter-section">
        <text class="filter-label">ç±»å‹ï¼š</text>
        <picker 
          class="filter-picker" 
          mode="selector" 
          range="{{pickerTypes}}" 
          value="{{typeIndex}}" 
          bindchange="onTypePickerChange"
        >
          <view class="picker-text">
            {{selectedType || 'å…¨éƒ¨'}}
            <text class="picker-arrow">â–¼</text>
          </view>
        </picker>
      </view>
      
      <view class="filter-section">
        <text class="filter-label">æ ‡ç­¾ï¼š</text>
        <scroll-view class="filter-scroll" scroll-x="true">
          <view class="filter-items">
            <text 
              class="filter-item {{selectedTag === '' ? 'active' : ''}}" 
              bindtap="onTagFilter" 
              data-tag=""
            >å…¨éƒ¨</text>
            <text 
              wx:for="{{activityTags}}" 
              wx:key="*this"
              class="filter-item {{selectedTag === item ? 'active' : ''}}" 
              bindtap="onTagFilter" 
              data-tag="{{item}}"
            >{{item}}</text>
          </view>
        </scroll-view>
      </view>
    </view>
  </view>

  <!-- æ´»åŠ¨åˆ—è¡¨ -->
  <scroll-view class="activity-list" scroll-y="true" bindscrolltolower="onLoadMore">
    <view wx:if="{{filteredActivities.length === 0 && !loading}}" class="empty-state">
      <text class="empty-icon">ğŸ“­</text>
      <text class="empty-text">{{searchKeyword ? 'æ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ´»åŠ¨' : 'æš‚æ— æ´»åŠ¨'}}</text>
    </view>

    <view wx:for="{{filteredActivities}}" wx:key="id" class="activity-card" bindtap="onActivityTap" data-id="{{item.id}}">
      <!-- æ´»åŠ¨çŠ¶æ€æ ‡ç­¾ -->
      <view class="status-tag {{item.status === 'active' ? 'active' : 'expired'}}">
        {{item.status === 'active' ? 'æŠ¥åä¸­' : 'å·²æˆªæ­¢'}}
      </view>

      <!-- æ´»åŠ¨å›¾ç‰‡ -->
      <image class="activity-image" src="{{item.image}}" mode="aspectFill" binderror="onListImageError" data-index="{{index}}"></image>

      <!-- æ´»åŠ¨ä¿¡æ¯ -->
      <view class="activity-info">
        <view class="activity-header">
          <text class="activity-title">{{item.title}}</text>
          <view class="activity-meta">
            <text class="activity-date">{{item.startDate}}</text>
          </view>
        </view>

        <text class="activity-description">{{item.description}}</text>

        <view class="activity-footer">
          <view class="activity-stats">
            <text class="stat-icon">ğŸ‘¥</text>
            <text class="stat-text">{{item.registeredCount}}/{{item.maxParticipants}}äºº</text>
          </view>
          <view class="activity-deadline">
            <text class="stat-icon">â°</text>
            <text class="stat-text">æˆªæ­¢ï¼š{{item.deadline}}</text>
          </view>
        </view>

        <!-- æ´»åŠ¨æ ‡ç­¾å’Œåˆ†ç±» -->
        <view class="activity-tags-section">
          <view class="activity-tags">
            <text wx:for="{{item.tags}}" wx:key="*this" class="tag">{{item}}</text>
          </view>
          <view class="activity-category">
            <text class="category-text">{{item.category || 'å…¶ä»–'}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{loading}}" class="loading">
      <text>åŠ è½½ä¸­...</text>
    </view>
    <view wx:if="{{noMoreData && filteredActivities.length > 0}}" class="no-more">
      <text>æ²¡æœ‰æ›´å¤šæ´»åŠ¨äº†</text>
    </view>
  </scroll-view>
</view>
