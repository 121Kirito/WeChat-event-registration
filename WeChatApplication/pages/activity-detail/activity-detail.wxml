<!--activity-detail.wxml - æ´»åŠ¨è¯¦æƒ…é¡µé¢-->
<view class="container">
  <!-- æ´»åŠ¨å›¾ç‰‡è½®æ’­ -->
  <swiper class="activity-swiper" indicator-dots="true" autoplay="false" interval="3000" duration="500">
    <swiper-item wx:for="{{activity.images}}" wx:key="*this">
      <image class="swiper-image" src="{{item}}" mode="aspectFill" binderror="onDetailImageError" data-index="{{index}}"></image>
    </swiper-item>
  </swiper>

  <!-- æ´»åŠ¨åŸºæœ¬ä¿¡æ¯ -->
  <view class="activity-header">
    <view class="activity-title-section">
      <text class="activity-title">{{activity.title}}</text>
      <view class="status-tag {{activity.status === 'active' ? 'active' : 'expired'}}">
        {{activity.status === 'active' ? 'æŠ¥åä¸­' : 'å·²æˆªæ­¢'}}
      </view>
    </view>
    
    <view class="activity-meta">
      <view class="meta-item">
        <text class="meta-icon">ğŸ•</text>
        <text class="meta-text">æ´»åŠ¨æ—¶é—´ï¼š{{activity.startDate}} {{activity.startTime}}</text>
      </view>
      <view class="meta-item">
        <text class="meta-icon">ğŸ“</text>
        <text class="meta-text">æ´»åŠ¨åœ°ç‚¹ï¼š{{activity.location}}</text>
      </view>
      <view class="meta-item">
        <text class="meta-icon">ğŸ‘¥</text>
        <text class="meta-text">æŠ¥åäººæ•°ï¼š{{activity.registeredCount}}/{{activity.maxParticipants}}äºº</text>
      </view>
      <view class="meta-item">
        <text class="meta-icon">â°</text>
        <text class="meta-text">æŠ¥åæˆªæ­¢ï¼š{{activity.deadline}}</text>
      </view>
    </view>
  </view>

  <!-- æ´»åŠ¨è¯¦æƒ…å†…å®¹ -->
  <view class="activity-content">
    <view class="content-section">
      <view class="section-title">æ´»åŠ¨ä»‹ç»</view>
      <text class="section-content">{{activity.description}}</text>
    </view>

    <view class="content-section" wx:if="{{activity.requirements}}">
      <view class="section-title">å‚ä¸è¦æ±‚</view>
      <text class="section-content">{{activity.requirements}}</text>
    </view>

    <view class="content-section" wx:if="{{activity.schedule}}">
      <view class="section-title">æ´»åŠ¨å®‰æ’</view>
      <text class="section-content">{{activity.schedule}}</text>
    </view>

    <view class="content-section" wx:if="{{activity.rewards}}">
      <view class="section-title">å¥–åŠ±è¯´æ˜</view>
      <text class="section-content">{{activity.rewards}}</text>
    </view>

    <view class="content-section" wx:if="{{activity.contact}}">
      <view class="section-title">è”ç³»æ–¹å¼</view>
      <text class="section-content">{{activity.contact}}</text>
    </view>
  </view>

  <!-- æ´»åŠ¨æ ‡ç­¾ -->
  <view class="activity-tags" wx:if="{{activity.tags && activity.tags.length > 0}}">
    <view class="tags-title">æ´»åŠ¨æ ‡ç­¾</view>
    <view class="tags-list">
      <text wx:for="{{activity.tags}}" wx:key="*this" class="tag">{{item}}</text>
    </view>
  </view>

  <!-- æŠ¥åè€…åˆ—è¡¨ -->
  <view class="participants-section" wx:if="{{participants.length > 0}}">
    <view class="section-title">å·²æŠ¥åç”¨æˆ·</view>
    <view class="participants-list">
      <view wx:for="{{participants}}" wx:key="id" class="participant-item">
        <image class="participant-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
        <text class="participant-name">{{item.name}}</text>
        <text class="participant-time">{{item.registerTime}}</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <view class="action-info">
      <text class="price-text" wx:if="{{activity.fee > 0}}">è´¹ç”¨ï¼šÂ¥{{activity.fee}}</text>
      <text class="price-text free" wx:else>å…è´¹æ´»åŠ¨</text>
    </view>
    
    <button 
      class="register-btn {{canRegister ? 'active' : 'disabled'}}"
      bindtap="onRegister"
      disabled="{{!canRegister || isRegistered}}"
    >
      {{isRegistered ? 'å·²æŠ¥å' : (canRegister ? 'ç«‹å³æŠ¥å' : (registerReason || 'æŠ¥åå·²æˆªæ­¢'))}}
    </button>
  </view>
</view>

<!-- æŠ¥åç¡®è®¤å¼¹çª— -->
<view class="modal-overlay" wx:if="{{showRegisterModal}}" bindtap="onCloseModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">ç¡®è®¤æŠ¥å</text>
      <text class="close-btn" bindtap="onCloseModal">âœ•</text>
    </view>
    
    <view class="modal-body">
      <view class="confirm-info">
        <text class="confirm-title">{{activity.title}}</text>
        <view class="confirm-details">
          <text class="confirm-item">æ´»åŠ¨æ—¶é—´ï¼š{{activity.startDate}} {{activity.startTime}}</text>
          <text class="confirm-item">æ´»åŠ¨åœ°ç‚¹ï¼š{{activity.location}}</text>
          <text class="confirm-item" wx:if="{{activity.fee > 0}}">æ´»åŠ¨è´¹ç”¨ï¼šÂ¥{{activity.fee}}</text>
        </view>
      </view>
      
      <view class="form-section">
        <view class="form-item">
          <text class="form-label">å§“å</text>
          <input class="form-input" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" value="{{userInfo.name}}" bindinput="onNameInput" />
        </view>
        <view class="form-item">
          <text class="form-label">æ‰‹æœºå·</text>
          <input class="form-input" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" value="{{userInfo.phone}}" bindinput="onPhoneInput" />
        </view>
        <view class="form-item">
          <text class="form-label">å¤‡æ³¨</text>
          <textarea class="form-textarea" placeholder="é€‰å¡«ï¼Œå¦‚ç‰¹æ®Šéœ€æ±‚ç­‰" value="{{userInfo.remark}}" bindinput="onRemarkInput"></textarea>
        </view>
      </view>
    </view>
    
    <view class="modal-footer">
      <button class="cancel-btn" bindtap="onCloseModal">å–æ¶ˆ</button>
      <button class="confirm-btn" bindtap="onConfirmRegister">ç¡®è®¤æŠ¥å</button>
    </view>
  </view>
</view>