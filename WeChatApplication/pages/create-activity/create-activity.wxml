<!--create-activity.wxml - å‘å¸ƒæ´»åŠ¨é¡µé¢-->
<view class="container">
  <scroll-view class="form-scroll" scroll-y="true">
    <!-- åŸºæœ¬ä¿¡æ¯ -->
    <view class="form-section">
      <view class="section-title">åŸºæœ¬ä¿¡æ¯</view>
      
      <view class="form-item">
        <text class="form-label required">æ´»åŠ¨æ ‡é¢˜</text>
        <input 
          class="form-input" 
          placeholder="è¯·è¾“å…¥æ´»åŠ¨æ ‡é¢˜" 
          value="{{formData.title}}"
          bindinput="onTitleInput"
          maxlength="50"
        />
        <text class="char-count">{{formData.title.length}}/50</text>
      </view>
      
      <view class="form-item">
        <text class="form-label required">æ´»åŠ¨ç®€ä»‹</text>
        <textarea 
          class="form-textarea" 
          placeholder="è¯·ç®€è¦æè¿°æ´»åŠ¨å†…å®¹..." 
          value="{{formData.description}}"
          bindinput="onDescriptionInput"
          maxlength="200"
        ></textarea>
        <text class="char-count">{{formData.description.length}}/200</text>
      </view>
      
      <view class="form-item">
        <text class="form-label">æ´»åŠ¨åˆ†ç±»</text>
        <picker 
          range="{{categories}}" 
          range-key="name"
          value="{{categoryIndex}}"
          bindchange="onCategoryChange"
        >
          <view class="picker-display">
            {{categories[categoryIndex] ? categories[categoryIndex].name : 'è¯·é€‰æ‹©åˆ†ç±»'}}
            <text class="picker-arrow">â–¼</text>
          </view>
        </picker>
      </view>
    </view>

    <!-- æ—¶é—´åœ°ç‚¹ -->
    <view class="form-section">
      <view class="section-title">æ—¶é—´åœ°ç‚¹</view>
      
      <view class="form-item">
        <text class="form-label required">æ´»åŠ¨æ—¶é—´</text>
        <picker 
          mode="date" 
          value="{{formData.startDate}}"
          bindchange="onStartDateChange"
        >
          <view class="picker-display">
            {{formData.startDate || 'è¯·é€‰æ‹©æ—¥æœŸ'}}
            <text class="picker-arrow">â–¼</text>
          </view>
        </picker>
      </view>
      
      <view class="form-item">
        <text class="form-label required">å¼€å§‹æ—¶é—´</text>
        <picker 
          mode="time" 
          value="{{formData.startTime}}"
          bindchange="onStartTimeChange"
        >
          <view class="picker-display">
            {{formData.startTime || 'è¯·é€‰æ‹©æ—¶é—´'}}
            <text class="picker-arrow">â–¼</text>
          </view>
        </picker>
      </view>
      
      <view class="form-item">
        <text class="form-label required">æ´»åŠ¨åœ°ç‚¹</text>
        <input 
          class="form-input" 
          placeholder="è¯·è¾“å…¥æ´»åŠ¨åœ°ç‚¹" 
          value="{{formData.location}}"
          bindinput="onLocationInput"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label required">æŠ¥åæˆªæ­¢æ—¶é—´</text>
        <picker 
          mode="date" 
          value="{{formData.deadline}}"
          bindchange="onDeadlineChange"
        >
          <view class="picker-display">
            {{formData.deadline || 'è¯·é€‰æ‹©æˆªæ­¢æ—¥æœŸ'}}
            <text class="picker-arrow">â–¼</text>
          </view>
        </picker>
      </view>
    </view>

    <!-- å‚ä¸ä¿¡æ¯ -->
    <view class="form-section">
      <view class="section-title">å‚ä¸ä¿¡æ¯</view>
      
      <view class="form-item">
        <text class="form-label required">æœ€å¤§å‚ä¸äººæ•°</text>
        <input 
          class="form-input" 
          type="number" 
          placeholder="è¯·è¾“å…¥æœ€å¤§å‚ä¸äººæ•°" 
          value="{{formData.maxParticipants}}"
          bindinput="onMaxParticipantsInput"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">æ´»åŠ¨è´¹ç”¨</text>
        <view class="fee-input-wrapper">
          <text class="fee-symbol">Â¥</text>
          <input 
            class="form-input fee-input" 
            type="digit" 
            placeholder="0.00" 
            value="{{formData.fee}}"
            bindinput="onFeeInput"
          />
        </view>
        <text class="form-hint">å…è´¹æ´»åŠ¨è¯·å¡«å†™0</text>
      </view>
      
      <view class="form-item">
        <text class="form-label">å‚ä¸è¦æ±‚</text>
        <textarea 
          class="form-textarea" 
          placeholder="è¯·è¯´æ˜å‚ä¸æ´»åŠ¨çš„è¦æ±‚æˆ–æ¡ä»¶..." 
          value="{{formData.requirements}}"
          bindinput="onRequirementsInput"
          maxlength="300"
        ></textarea>
        <text class="char-count">{{formData.requirements.length}}/300</text>
      </view>
    </view>

    <!-- æ´»åŠ¨è¯¦æƒ… -->
    <view class="form-section">
      <view class="section-title">æ´»åŠ¨è¯¦æƒ…</view>
      
      <view class="form-item">
        <text class="form-label">æ´»åŠ¨å®‰æ’</text>
        <textarea 
          class="form-textarea" 
          placeholder="è¯·è¯¦ç»†è¯´æ˜æ´»åŠ¨æµç¨‹å’Œæ—¶é—´å®‰æ’..." 
          value="{{formData.schedule}}"
          bindinput="onScheduleInput"
          maxlength="500"
        ></textarea>
        <text class="char-count">{{formData.schedule.length}}/500</text>
      </view>
      
      <view class="form-item">
        <text class="form-label">å¥–åŠ±è¯´æ˜</text>
        <textarea 
          class="form-textarea" 
          placeholder="è¯·è¯´æ˜æ´»åŠ¨å¥–åŠ±æˆ–å¥–å“..." 
          value="{{formData.rewards}}"
          bindinput="onRewardsInput"
          maxlength="300"
        ></textarea>
        <text class="char-count">{{formData.rewards.length}}/300</text>
      </view>
      
      <view class="form-item">
        <text class="form-label">è”ç³»æ–¹å¼</text>
        <textarea 
          class="form-textarea" 
          placeholder="è¯·æä¾›è”ç³»äººä¿¡æ¯..." 
          value="{{formData.contact}}"
          bindinput="onContactInput"
          maxlength="200"
        ></textarea>
        <text class="char-count">{{formData.contact.length}}/200</text>
      </view>
    </view>

    <!-- æ´»åŠ¨å›¾ç‰‡ -->
    <view class="form-section">
      <view class="section-title">æ´»åŠ¨å›¾ç‰‡</view>
      
      <view class="form-item">
        <text class="form-label">ä¸Šä¼ å›¾ç‰‡</text>
        <view class="image-upload">
          <view 
            wx:for="{{formData.images}}" 
            wx:key="*this" 
            class="image-item"
          >
            <image class="uploaded-image" src="{{item}}" mode="aspectFill" binderror="onImageError" data-index="{{index}}"></image>
            <view class="image-delete" bindtap="onDeleteImage" data-index="{{index}}">
              <text class="delete-icon">âœ•</text>
            </view>
          </view>
          
          <view 
            wx:if="{{formData.images.length < 5}}"
            class="image-upload-btn" 
            bindtap="onChooseImage"
          >
            <text class="upload-icon">ğŸ“·</text>
            <text class="upload-text">æ·»åŠ å›¾ç‰‡</text>
          </view>
        </view>
        <text class="form-hint">æœ€å¤šä¸Šä¼ 5å¼ å›¾ç‰‡ï¼Œå»ºè®®å°ºå¯¸750x400px</text>
      </view>
    </view>

    <!-- æ´»åŠ¨æ ‡ç­¾ -->
    <view class="form-section">
      <view class="section-title">æ´»åŠ¨æ ‡ç­¾</view>
      
      <view class="form-item">
        <text class="form-label">é€‰æ‹©æ ‡ç­¾</text>
        <view class="tags-selector">
          <view 
            wx:for="{{availableTags}}" 
            wx:key="*this"
            class="tag-item {{formData.tags.includes(item) ? 'selected' : ''}}"
            bindtap="onToggleTag"
            data-tag="{{item}}"
          >
            {{item}}
          </view>
        </view>
        <text class="form-hint">æœ€å¤šé€‰æ‹©5ä¸ªæ ‡ç­¾</text>
      </view>
    </view>
  </scroll-view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <button class="preview-btn" bindtap="onPreview">é¢„è§ˆ</button>
    <button class="publish-btn" bindtap="onPublish">å‘å¸ƒæ´»åŠ¨</button>
  </view>
</view>

<!-- é¢„è§ˆå¼¹çª— -->
<view class="modal-overlay" wx:if="{{showPreviewModal}}" bindtap="onClosePreview">
  <view class="modal-content preview-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">æ´»åŠ¨é¢„è§ˆ</text>
      <text class="close-btn" bindtap="onClosePreview">âœ•</text>
    </view>
    
    <scroll-view class="preview-scroll" scroll-y="true">
      <view class="preview-activity">
        <!-- æ´»åŠ¨å›¾ç‰‡ -->
        <swiper wx:if="{{formData.images.length > 0}}" class="preview-swiper" indicator-dots="true">
          <swiper-item wx:for="{{formData.images}}" wx:key="*this">
            <image class="preview-image" src="{{item}}" mode="aspectFill" binderror="onImageError" data-index="{{index}}"></image>
          </swiper-item>
        </swiper>
        
        <!-- æ´»åŠ¨ä¿¡æ¯ -->
        <view class="preview-info">
          <text class="preview-title">{{formData.title}}</text>
          <text class="preview-description">{{formData.description}}</text>
          
          <view class="preview-meta">
            <view class="meta-item">
              <text class="meta-icon">ğŸ•</text>
              <text class="meta-text">{{formData.startDate}} {{formData.startTime}}</text>
            </view>
            <view class="meta-item">
              <text class="meta-icon">ğŸ“</text>
              <text class="meta-text">{{formData.location}}</text>
            </view>
            <view class="meta-item">
              <text class="meta-icon">ğŸ‘¥</text>
              <text class="meta-text">æœ€å¤š{{formData.maxParticipants}}äºº</text>
            </view>
          </view>
          
          <view class="preview-tags" wx:if="{{formData.tags.length > 0}}">
            <text wx:for="{{formData.tags}}" wx:key="*this" class="preview-tag">{{item}}</text>
          </view>
        </view>
      </view>
    </scroll-view>
    
    <view class="modal-footer">
      <button class="cancel-btn" bindtap="onClosePreview">ç»§ç»­ç¼–è¾‘</button>
      <button class="confirm-btn" bindtap="onConfirmPublish">ç¡®è®¤å‘å¸ƒ</button>
    </view>
  </view>
</view>